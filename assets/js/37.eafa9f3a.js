(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{594:function(t,a,e){"use strict";e.r(a);var n=e(7),s=Object(n.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"前言"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),e("p",[t._v("canvas的文本API很鸡肋。")]),t._v(" "),e("p",[t._v("大纲：")]),t._v(" "),e("ul",[e("li",[t._v("canvas文本的基础 API 以及问题")]),t._v(" "),e("li",[t._v("如何实现文本坐标轴")]),t._v(" "),e("li",[t._v("如何在 canvas 中实现多行文本")]),t._v(" "),e("li",[t._v("如何实现文本的两端对齐效果")]),t._v(" "),e("li",[t._v("如何实现文本自动换行")]),t._v(" "),e("li",[t._v("如何实现删除线的功能")])]),t._v(" "),e("h2",{attrs:{id:"canvas文本-api"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#canvas文本-api"}},[t._v("#")]),t._v(" Canvas文本 API")]),t._v(" "),e("p",[t._v("canvas文字绘制主要有两个API:")]),t._v(" "),e("ul",[e("li",[t._v("文本绘制："),e("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/fillText",target:"_blank",rel:"noopener noreferrer"}},[t._v("ctx.fillText(text, x, y [, maxWidth])"),e("OutboundLink")],1)]),t._v(" "),e("li",[t._v("文本描边："),e("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/strokeText",target:"_blank",rel:"noopener noreferrer"}},[t._v("ctx.strokeText(text, x, y [, maxWidth])"),e("OutboundLink")],1)])]),t._v(" "),e("h2",{attrs:{id:"实现删除线"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实现删除线"}},[t._v("#")]),t._v(" 实现删除线")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("element"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("textDecoration "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TEXT_DECORATION")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lineThrough"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("textBaseline "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"alphabetic"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" text "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" lines"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("index"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" x "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" horizontalOffset"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" y "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" index "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" lineHeightPx "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" lineHeightPx "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" textWidth "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("measureText")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("text"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("width"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("beginPath")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("moveTo")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("lineTo")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" textWidth"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("strokeStyle "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" element"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("strokeColor"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lineWidth "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("getLineThrough")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("element"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fontSize"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("stroke")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br")])]),e("p",[t._v("ctx.fillText(text, x, y [, maxWidth])，文字的绘制坐标与(x,y)，ctx.textAlign，ctx.textBaseline息息相关")]),t._v(" "),e("p",[t._v("下面列举了不同的(textAlign/textBaseline)的组合，以及对应的效果：")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/chenxiaoyao6228/cloudimg@main/2023/canvas-textAlign-textBaseline.png",alt:""}})]),t._v(" "),e("p",[t._v("完整的 demo 请看👉 "),e("a",{attrs:{href:"https://chenxiaoyao6228.github.io/html-preview/?https://github.com/chenxiaoyao6228/fe-notes/blob/main/Canvas/_demo/canvas-text/canvas-textAlign-textBaseline.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("在线效果预览"),e("OutboundLink")],1),t._v(", 查看示例代码请点击"),e("RouterLink",{attrs:{to:"/docs/Canvas/_demo/canvas-text/canvas-textAlign-textBaseline.html"}},[t._v("此处")]),t._v("。")],1),t._v(" "),e("p",[t._v("其中，黄色的小方格代表的是传入fillText的x,y坐标绘制出来的图形。")]),t._v(" "),e("p",[t._v("可以看到，当"),e("code",[t._v("textAlign=middle")]),t._v(", "),e("code",[t._v("verticalAlign=middle")]),t._v("时，文本的中心点与黄色小方格的中心点重合。")]),t._v(" "),e("h2",{attrs:{id:"真的垂直居中了吗"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#真的垂直居中了吗"}},[t._v("#")]),t._v(" 真的垂直居中了吗？")]),t._v(" "),e("p",[t._v("经过测试，不同的字体会影响垂直居中的效果。观察下图可以看到，在不同的字体下，中间线并不一定准确穿过字母 X 的中点")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/chenxiaoyao6228/cloudimg@main/2023/canvas-textBase-middle-in-different-font.png",alt:""}})]),t._v(" "),e("p",[t._v("完整的 demo 请看👉 "),e("a",{attrs:{href:"https://chenxiaoyao6228.github.io/html-preview/?https://github.com/chenxiaoyao6228/fe-notes/blob/main/Canvas/_demo/canvas-text/canvas-textBaseline-middle.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("在线效果预览"),e("OutboundLink")],1),t._v(", 查看示例代码请点击"),e("RouterLink",{attrs:{to:"/docs/Canvas/_demo/canvas-text/canvas-textBaseline-middle.html"}},[t._v("此处")])],1),t._v(" "),e("p",[t._v("看来"),e("code",[t._v("textBaseline:middle")]),t._v("无法满足我们的需求，那么有没有其他的方法呢？")]),t._v(" "),e("h2",{attrs:{id:"ctx-measuretext"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ctx-measuretext"}},[t._v("#")]),t._v(" ctx.measureText")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/chenxiaoyao6228/cloudimg@main/2023/canvas-text-vertical-align-with-measure-text.png",alt:""}})]),t._v(" "),e("p",[t._v("完整的 demo 请看👉 "),e("a",{attrs:{href:"https://chenxiaoyao6228.github.io/html-preview/?https://github.com/chenxiaoyao6228/fe-notes/blob/main/Canvas/_demo/canvas-text/vertical-align-with-text-measure.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("在线效果预览"),e("OutboundLink")],1),t._v(", 查看示例代码请点击"),e("RouterLink",{attrs:{to:"/docs/Canvas/_demo/canvas-text/vertical-align-with-text-measure.html"}},[t._v("此处")])],1),t._v(" "),e("h2",{attrs:{id:"参考"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),e("ul",[e("li",[e("p",[e("a",{attrs:{href:"https://juejin.cn/post/6844903538745671694",target:"_blank",rel:"noopener noreferrer"}},[t._v("深入理解 CSS：字体度量、line-height 和 vertical-align"),e("OutboundLink")],1)])]),t._v(" "),e("li",[e("p",[t._v("https://stackoverflow.com/questions/67672635/why-the-text-in-canvas-cant-be-centered-vertically")])]),t._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/TextMetrics",target:"_blank",rel:"noopener noreferrer"}},[t._v("MDN TextMetrics"),e("OutboundLink")],1)])]),t._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://www.npmjs.com/search?q=text%20canvas",target:"_blank",rel:"noopener noreferrer"}},[t._v("canvas text"),e("OutboundLink")],1)])]),t._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://www.npmjs.com/package/canvas-hypertxt",target:"_blank",rel:"noopener noreferrer"}},[t._v("canvas-hypertxt"),e("OutboundLink")],1)])]),t._v(" "),e("li",[e("p",[t._v("https://stackoverflow.com/questions/4627133/is-it-possible-to-draw-text-decoration-underline-etc-with-html5-canvas-text")])]),t._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://www.zhangxinxu.com/wordpress/2018/02/canvas-text-break-line-letter-spacing-vertical/",target:"_blank",rel:"noopener noreferrer"}},[t._v("canvas 文本绘制自动换行、字间距、竖排等实现"),e("OutboundLink")],1)])]),t._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/TextMetrics",target:"_blank",rel:"noopener noreferrer"}},[t._v("TextMetrics"),e("OutboundLink")],1)])]),t._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://www.zhihu.com/question/22183501",target:"_blank",rel:"noopener noreferrer"}},[t._v("中文到底有没有基线（baseline）的概念"),e("OutboundLink")],1)])])])])}),[],!1,null,null,null);a.default=s.exports}}]);